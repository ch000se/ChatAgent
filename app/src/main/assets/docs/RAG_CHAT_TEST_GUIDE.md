# RAG Chat –∑ –ø–∞–º'—è—Ç—Ç—é —Ç–∞ –¥–∂–µ—Ä–µ–ª–∞–º–∏ - –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—é

## –©–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

–ú—ñ–Ω—ñ-—á–∞—Ç –±–æ—Ç –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏:
- ‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –¥—ñ–∞–ª–æ–≥—É (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö)
- ‚úÖ –ü–æ—à—É–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –≤ –±–∞–∑—ñ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ RAG –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–∏—Ç–∞–Ω–Ω—ñ
- ‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–Ω–∞–π–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- ‚úÖ **–û–±–æ–≤'—è–∑–∫–æ–≤–∏–π –≤–∏–≤—ñ–¥ –¥–∂–µ—Ä–µ–ª** –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏
- ‚úÖ –†–æ–∑–∫—Ä–∏–≤–Ω—ñ —Å–µ–∫—Ü—ñ—ó –∑ –¥–µ—Ç–∞–ª—è–º–∏ –¥–∂–µ—Ä–µ–ª
- ‚úÖ –ü–æ–∫–∞–∑ —Å—Ö–æ–∂–æ—Å—Ç—ñ (similarity score) –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞
- ‚úÖ –¢–æ–∫–µ–Ω usage tracking

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ä—ñ—à–µ–Ω–Ω—è

### 1. –ú–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö
- **Message** - —Ä–æ–∑—à–∏—Ä–µ–Ω–æ –ø–æ–ª–µ–º `sources: List<DocumentSearchResult>?`
- **MessageEntity** - –¥–æ–¥–∞–Ω–æ `sourcesJson` –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª –≤ –ë–î
- –í–µ—Ä—Å—ñ—è –ë–î –æ–Ω–æ–≤–ª–µ–Ω–∞ –∑ 2 –¥–æ 3

### 2. ViewModel: RagChatViewModel
- –Ü–Ω—Ç–µ–≥—Ä—É—î `SearchDocumentsUseCase` –¥–ª—è –ø–æ—à—É–∫—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ:
  1. –®—É–∫–∞—î —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (Top-5, similarity > 0.1)
  2. –ë—É–¥—É—î RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö —á–∞–Ω–∫—ñ–≤
  3. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π –ø—Ä–æ–º–ø—Ç –¥–æ LLM
  4. –ü—Ä–∏–∫—Ä—ñ–ø–ª—é—î –¥–∂–µ—Ä–µ–ª–∞ –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
  5. –ó–±–µ—Ä—ñ–≥–∞—î –≤—Å–µ –≤ –ë–î

### 3. UI: RagChatScreen
- –ë—É–ª—å–±–∞—à–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–ª—å–æ—Ä–∞–º–∏ –¥–ª—è user/assistant
- **Sources Section** (—Ç—ñ–ª—å–∫–∏ –¥–ª—è assistant –∑ –¥–∂–µ—Ä–µ–ª–∞–º–∏):
  - –ö–Ω–æ–ø–∫–∞ —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è/–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª
  - –ü—Ä–∏ —Ä–æ–∑–∫—Ä–∏—Ç—Ç—ñ –ø–æ–∫–∞–∑—É—î:
    - –ù–∞–∑–≤—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
    - % —Å—Ö–æ–∂–æ—Å—Ç—ñ (–∫–æ–ª—å–æ—Ä–æ–≤–µ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è)
    - –¢–µ–∫—Å—Ç —á–∞–Ω–∫—É
    - –ù–æ–º–µ—Ä —á–∞–Ω–∫—É
- Token usage stats –≤–≥–æ—Ä—ñ –µ–∫—Ä–∞–Ω—É
- –ö–Ω–æ–ø–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è —á–∞—Ç—É

## –Ø–∫ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏

### –ö—Ä–æ–∫ 1: –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç—É

#### –û–ø—Ü—ñ—è –ê: Android Studio
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Android Studio
2. –î–æ—á–µ–∫–∞–π—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è Gradle Sync
3. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å Android –ø—Ä–∏—Å—Ç—Ä—ñ–π –∞–±–æ –∑–∞–ø—É—Å—Ç—ñ—Ç—å –µ–º—É–ª—è—Ç–æ—Ä
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å `Run` (–∑–µ–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ play)

#### –û–ø—Ü—ñ—è –ë: –ö–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫ (—è–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ JAVA_HOME)
```bash
# Windows
gradlew.bat assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk

# Linux/Mac
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

### –ö—Ä–æ–∫ 2: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

1. **–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –µ–∫—Ä–∞–Ω Documents** (—ñ–∫–æ–Ω–∫–∞ üìÑ –≤ –≥–æ–ª–æ–≤–Ω–æ–º—É —á–∞—Ç—ñ)
2. **–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ç–µ—Å—Ç–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏**:
   - –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏ (.txt) –∑ —Ä—ñ–∑–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
   - –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
     - `products.txt`: "–ù–∞—à –º–∞–≥–∞–∑–∏–Ω –ø—Ä–æ–¥–∞—î –Ω–æ—É—Ç–±—É–∫–∏ Dell, MacBook, —Ç–∞ Lenovo. –¶—ñ–Ω–∏ –≤—ñ–¥ $500 –¥–æ $2000."
     - `policy.txt`: "–ì–∞—Ä–∞–Ω—Ç—ñ—è –Ω–∞ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ 2 —Ä–æ–∫–∏. –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–µ –ø—Ä–æ—Ç—è–≥–æ–º 14 –¥–Ω—ñ–≤."
     - `contacts.txt`: "–¢–µ—Ö –ø—ñ–¥—Ç—Ä–∏–º–∫–∞: support@example.com, —Ç–µ–ª: +380123456789"

3. **–Ü–Ω–¥–µ–∫—Å—É–π—Ç–µ –∫–æ–∂–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç**:
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Index Document"
   - –î–æ—á–µ–∫–∞–π—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (progress bar)
   - –°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–∏—Ç—å—Å—è –Ω–∞ "Indexed"

### –ö—Ä–æ–∫ 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è RAG Chat

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ RAG Chat**:
   - –ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω (Chat Agent)
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —ñ–∫–æ–Ω–∫—É üí¨ (Chat) –≤ –≤–µ—Ä—Ö–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ
   - –í—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –µ–∫—Ä–∞–Ω "RAG Chat with Sources"

2. **–¢–µ—Å—Ç–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó**:

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ü–∏—Ç–∞–Ω–Ω—è –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
```
–ó–∞–ø–∏—Ç–∞–Ω–Ω—è: "–Ø–∫—ñ –Ω–æ—É—Ç–±—É–∫–∏ —É –≤–∞—Å —î?"

–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
- –í—ñ–¥–ø–æ–≤—ñ–¥—å –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ Dell, MacBook, Lenovo
- ‚≠ê –°–µ–∫—Ü—ñ—è "Sources (N)" –≤–Ω–∏–∑—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- –ü—Ä–∏ —Ä–æ–∑–∫—Ä–∏—Ç—Ç—ñ –≤–∏–¥–Ω–æ:
  - –ù–∞–∑–≤—É —Ñ–∞–π–ª—É: products.txt
  - % —Å—Ö–æ–∂–æ—Å—Ç—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 78.5%)
  - –¢–µ–∫—Å—Ç —á–∞–Ω–∫—É –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ü–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –ø–æ–ª—ñ—Ç–∏–∫—É
```
–ó–∞–ø–∏—Ç–∞–Ω–Ω—è: "–Ø–∫–∞ –≥–∞—Ä–∞–Ω—Ç—ñ—è –Ω–∞ —Ç–æ–≤–∞—Ä–∏?"

–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
- –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–æ 2 —Ä–æ–∫–∏ –≥–∞—Ä–∞–Ω—Ç—ñ—ó
- Sources –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ policy.txt
- –í–∏—Å–æ–∫–∏–π % —Å—Ö–æ–∂–æ—Å—Ç—ñ (70%+)
```

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ü–∏—Ç–∞–Ω–Ω—è –∑ –∫—ñ–ª—å–∫–æ–º–∞ –¥–∂–µ—Ä–µ–ª–∞–º–∏
```
–ó–∞–ø–∏—Ç–∞–Ω–Ω—è: "–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ –º–∞–≥–∞–∑–∏–Ω —Ç–∞ —è–∫ –∑ –≤–∞–º–∏ –∑–≤'—è–∑–∞—Ç–∏—Å—è"

–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
- –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
- Sources (2-3) - –º–æ–∂–µ –±—É—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ñ–∞–π–ª—ñ–≤:
  - products.txt
  - contacts.txt
  - policy.txt
- –ö–æ–∂–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –∑ –≤–ª–∞—Å–Ω–∏–º % —Å—Ö–æ–∂–æ—Å—Ç—ñ
```

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 4: –ü–∏—Ç–∞–Ω–Ω—è –±–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
```
–ó–∞–ø–∏—Ç–∞–Ω–Ω—è: "–Ø–∫–∞ –ø–æ–≥–æ–¥–∞ –≤ –ö–∏—î–≤—ñ?"

–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
- LLM –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –∑–Ω–∞–Ω—å
- Sources –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ –∞–±–æ –º–∞—Ç–∏ –Ω–∏–∑—å–∫—É —Å—Ö–æ–∂—ñ—Å—Ç—å (<30%)
- –ê—Å–∏—Å—Ç–µ–Ω—Ç –º–æ–∂–µ —Å–∫–∞–∑–∞—Ç–∏ "–Ω–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö"
```

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –¥–∂–µ—Ä–µ–ª

1. **–†–æ–∑–∫—Ä–∏—Ç—Ç—è/–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Sources**:
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ "Sources (N)"
   - –ú–∞—î –∞–Ω—ñ–º–æ–≤–∞–Ω–æ —Ä–æ–∑–∫—Ä–∏—Ç–∏—Å—è —Å–ø–∏—Å–æ–∫
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–µ —Ä–∞–∑ - –∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è

2. **–ö–æ–ª—å–æ—Ä–æ–≤–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è —Å—Ö–æ–∂–æ—Å—Ç—ñ**:
   - –ó–µ–ª–µ–Ω–∏–π (70%+): –î—É–∂–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ
   - –ñ–æ–≤—Ç–∏–π (50-70%): –ü–æ–º—ñ—Ä–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ
   - –°—ñ—Ä–∏–π (<50%): –°–ª–∞–±–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—Å—Ç—å

3. **–î–µ—Ç–∞–ª—ñ –¥–∂–µ—Ä–µ–ª–∞**:
   - –Ü–º'—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
   - –ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç —á–∞–Ω–∫—É
   - –ù–æ–º–µ—Ä —á–∞–Ω–∫—É (#1, #2, —Ç–æ—â–æ)

### –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞–º'—è—Ç—ñ —á–∞—Ç—É

1. **–ó–∞–¥–∞–π—Ç–µ –¥–µ–∫—ñ–ª—å–∫–∞ –ø–∏—Ç–∞–Ω—å –ø—ñ–¥—Ä—è–¥**:
```
User: "–Ø–∫—ñ –Ω–æ—É—Ç–±—É–∫–∏ —î?"
Assistant: [–≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑ –¥–∂–µ—Ä–µ–ª–∞–º–∏]

User: "–ê —Ü—ñ–Ω–∏?"
Assistant: [–º–∞—î –∑–≥–∞–¥–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –Ω–æ—É—Ç–±—É–∫–∏]
```

2. **–ó–∞–∫—Ä–∏–π—Ç–µ –¥–æ–¥–∞—Ç–æ–∫ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –∑–Ω–æ–≤—É**:
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ RAG Chat
   - –Ü—Å—Ç–æ—Ä—ñ—è –º–∞—î –∑–±–µ—Ä–µ–≥—Ç–∏—Å—è (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è –∑ –ë–î)

3. **–û—á–∏—Å—Ç—ñ—Ç—å —á–∞—Ç**:
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —ñ–∫–æ–Ω–∫—É üóëÔ∏è (Delete) –≤–≥–æ—Ä—ñ
   - –í—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è

### –ö—Ä–æ–∫ 6: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Token Usage

- –í–≥–æ—Ä—ñ –µ–∫—Ä–∞–Ω—É –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è:
  - **In**: –í—Ö—ñ–¥–Ω—ñ —Ç–æ–∫–µ–Ω–∏
  - **Out**: –í–∏—Ö—ñ–¥–Ω—ñ —Ç–æ–∫–µ–Ω–∏
  - **Total**: –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–∫–æ–ø–∏—á—É—î—Ç—å—Å—è –¥–ª—è –≤—Å—ñ—î—ó —Å–µ—Å—ñ—ó
- –ö–æ–∂–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è assistant –ø–æ–∫–∞–∑—É—î —Å–≤–æ—ó —Ç–æ–∫–µ–Ω–∏ –≤–Ω–∏–∑—É –±—É–ª—å–±–∞—à–∫–∏

## –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### ‚úÖ –£—Å–ø—ñ—à–Ω–∏–π —Ç–µ—Å—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏ —É—Å–ø—ñ—à–Ω–æ —ñ–Ω–¥–µ–∫—Å—É—é—Ç—å—Å—è
- [ ] –ü–∏—Ç–∞–Ω–Ω—è –≥–µ–Ω–µ—Ä—É—é—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- [ ] **–î–∂–µ—Ä–µ–ª–∞ –ó–ê–í–ñ–î–ò –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è** –¥–ª—è assistant –∑ –∑–Ω–∞–π–¥–µ–Ω–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- [ ] –ú–æ–∂–Ω–∞ —Ä–æ–∑–∫—Ä–∏–≤–∞—Ç–∏/–∑–≥–æ—Ä—Ç–∞—Ç–∏ Sources
- [ ] % —Å—Ö–æ–∂–æ—Å—Ç—ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- [ ] –Ü—Å—Ç–æ—Ä—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –º—ñ–∂ —Å–µ–∞–Ω—Å–∞–º–∏
- [ ] Token usage –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è

### ‚ùå –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: Sources –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏
- –°–ø—Ä–æ–±—É–π—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è –∑ —è–≤–Ω–∏–º –∑–≥–∞–¥—É–≤–∞–Ω–Ω—è–º –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Ä—ñ–≥ —Å—Ö–æ–∂–æ—Å—Ç—ñ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 0.1)

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –ú–æ–∂–ª–∏–≤–æ similarity threshold –∑–∞–Ω–∞–¥—Ç–æ –≤–∏—Å–æ–∫–∏–π
- –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è –±–ª–∏–∂—á–µ –¥–æ —Ç–µ–∫—Å—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–æ–¥–∞—Ç–æ–∫ –∫—Ä–µ—à–∏—Ç—å—Å—è
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é –ë–î (–º–∞—î –±—É—Ç–∏ 3)
- –í–∏–¥–∞–ª—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫ —Ç–∞ –ø–µ—Ä–µ—ñ–Ω—Å—Ç–∞–ª—é–π—Ç–µ
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: `adb logcat | grep "ChatAgent"`

**–ü—Ä–æ–±–ª–µ–º–∞**: Build –ø–æ–º–∏–ª–∫–∏
- –í–∏–∫–æ–Ω–∞–π—Ç–µ: `./gradlew clean build`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é Gradle —Ç–∞ JDK
- Sync Project with Gradle Files –≤ Android Studio

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥—É

```
presentation/
‚îú‚îÄ‚îÄ ragchat/
‚îÇ   ‚îú‚îÄ‚îÄ RagChatViewModel.kt     # –õ–æ–≥—ñ–∫–∞ RAG —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
‚îÇ   ‚îî‚îÄ‚îÄ RagChatScreen.kt        # UI –∑ Sources –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îî‚îÄ‚îÄ ChatScreen.kt           # –î–æ–¥–∞–Ω–æ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥—É –≤ RAG Chat
‚îî‚îÄ‚îÄ navigation/
    ‚îî‚îÄ‚îÄ NavGraph.kt             # –î–æ–¥–∞–Ω–æ –º–∞—Ä—à—Ä—É—Ç Screen.RagChat

domain/model/
‚îî‚îÄ‚îÄ Message.kt                  # –î–æ–¥–∞–Ω–æ sources: List<DocumentSearchResult>?

data/
‚îú‚îÄ‚îÄ local/entity/
‚îÇ   ‚îî‚îÄ‚îÄ MessageEntity.kt        # –î–æ–¥–∞–Ω–æ sourcesJson: String?
‚îî‚îÄ‚îÄ mapper/
    ‚îî‚îÄ‚îÄ MessageMapper.kt        # –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è sources –≤ JSON
```

## API Reference

### RagChatViewModel methods:
- `sendMessage()` - –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ RAG –ø–æ—à—É–∫–æ–º
- `clearChat()` - –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —á–∞—Ç—É
- `toggleSourcesExpanded(messageId)` - –†–æ–∑–∫—Ä–∏—Ç–∏/–∑–≥–æ—Ä–Ω—É—Ç–∏ –¥–∂–µ—Ä–µ–ª–∞

### RagChatUiState fields:
- `messages: List<Message>` - –°–ø–∏—Å–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- `expandedSources: Set<String>` - ID —Ä–æ–∑–∫—Ä–∏—Ç–∏—Ö –¥–∂–µ—Ä–µ–ª
- `totalTokens: Int` - –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω—ñ–≤

### Message fields:
- `sources: List<DocumentSearchResult>?` - –î–∂–µ—Ä–µ–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
  - `chunk: DocumentChunk` - –¢–µ–∫—Å—Ç–æ–≤–∏–π —á–∞–Ω–∫
  - `document: Document` - –ú–µ—Ç–∞–¥–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  - `similarity: Float` - –û—Ü—ñ–Ω–∫–∞ —Å—Ö–æ–∂–æ—Å—Ç—ñ (0.0-1.0)
  - `rank: Int` - –†–∞–Ω–≥ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ—à—É–∫—É

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ —ñ–Ω—à–∏–º–∏ –µ–∫—Ä–∞–Ω–∞–º–∏

| –§—É–Ω–∫—Ü—ñ—è | Chat Screen | RAG Comparison | **RAG Chat** |
|---------|-------------|----------------|--------------|
| –Ü—Å—Ç–æ—Ä—ñ—è –¥—ñ–∞–ª–æ–≥—É | ‚úÖ | ‚ùå | ‚úÖ |
| RAG –ø–æ—à—É–∫ | ‚ùå | ‚úÖ | ‚úÖ |
| –ü–æ–∫–∞–∑ –¥–∂–µ—Ä–µ–ª | ‚ùå | ‚úÖ (side-by-side) | ‚úÖ (—Ä–æ–∑–∫—Ä–∏–≤–Ω—ñ) |
| MCP Tools | ‚úÖ | ‚ùå | ‚ùå |
| –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î | ‚úÖ | ‚ùå | ‚úÖ |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π RAG | ‚ùå | Manual | ‚úÖ |

## –í–∏—Å–Ω–æ–≤–æ–∫

RAG Chat - —Ü–µ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π —á–∞—Ç-–±–æ—Ç –∑:
1. **–ü–∞–º'—è—Ç—Ç—é** - —ñ—Å—Ç–æ—Ä—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ Room DB
2. **RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–∏—Ç–∞–Ω–Ω—ñ
3. **–î–∂–µ—Ä–µ–ª–∞–º–∏** - –æ–±–æ–≤'—è–∑–∫–æ–≤–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–≤—ñ–¥–∫–∏ –≤–∑—è—Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
4. **–ó—Ä—É—á–Ω–∏–º UI** - —Ä–æ–∑–∫—Ä–∏–≤–Ω—ñ —Å–µ–∫—Ü—ñ—ó, –∫–æ–ª—å–æ—Ä–æ–≤–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è, token tracking

–¶–µ CLI/Android —á–∞—Ç –∑ RAG-–ø–∞–º'—è—Ç—Ç—é —Ç–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ –¥–∂–µ—Ä–µ–ª–∞, —è–∫ —ñ –±—É–ª–æ –≤ –∑–∞–≤–¥–∞–Ω–Ω—ñ! üéâ
